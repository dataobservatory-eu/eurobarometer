---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(here)
```

# eurobarometer

<!-- badges: start -->
[![dataobservatory on Github](https://img.shields.io/badge/github-dataobservatory.eu-6e5494.svg)](https://github.com/dataobservatory-eu/)
[![R package retroharmonize](https://img.shields.io/badge/R-retroharmonize-007CBB.svg)](https://retroharmonize.dataobservatory.eu)
[![dataset](https://img.shields.io/badge/R-dataset-E4007F.svg)](https://dataset.dataobservatory.eu)
[![Contributor Covenant](https://img.shields.io/badge/ethics-Contributor%20Covenant-680171.svg)](https://dataobservatory.eu/)
[![Project Status: Active. The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![license](https://img.shields.io/badge/license-GPL--3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0.en.html)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/dataobservatory-eu/eurobarometer?branch=main&svg=true)](https://ci.appveyor.com/project/dataobservatory-eu/eurobarometer)
<!-- badges: end -->

The goal of eurobarometer is to provide helper functions for the use of the [retroharmonize](https://retroharmonize.dataobservatory.eu/) package when working with SPSS versions of the Eurobarometer surveys files that are stored at GESIS. This package was not made, and is not affiliated with GESIS.

## Installation

You can install the development version of eurobarometer from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("dataobservatory-eu/eurobarometer")
```

You will also need similarly `devtools::install_github("dataobservatory-eu/dataset")` (at least version 0.1.9.0004) and the latest version of declared.

## Work with GESIS survey datasets

The `read_sav_gesis()` function is a wrapper with `DDIwR::convert()` with the following modifications:

```{r read-file}
library(eurobarometer)
ZA5933 <- read_sav_gesis(file = system.file("extdata", "ZA5933_sample.sav", 
                                            package = "eurobarometer"))
```

- The original, labelled survey variables are stored as [declared](https://declared.dataobservatory.eu/reference/declared.html), which has many advantages compared to the labelled class used by haven.
- The study-level metadata is added as metadata to the data.frame with [dataset::dublincore_add](https://dataset.dataobservatory.eu/reference/dublincore.html).
- A truly unique identifier is added to the dataset. GESIS's `uniqid` identifier is designed to be unique within one _wave_ of Eurobarometer surveys.  To avoid identification duplication, retroharmonize adds an `id` to each row.

```{r small-sample, echo=FALSE, message=FALSE}
library(dplyr)
set.seed(1234)
ZA5933_sample <-ZA5933 %>%
  select ( any_of(c("id", "uniqid", "d25"))) %>%
  sample_n(12) %>%
  mutate ( d25_num = as.numeric(.data$d25), 
           d25_chr = as.character(.data$d25))
```

## Advantages of declared

The use of declared makes type conversions (and recoding, relabelling) easier.

```{r declared-class}
ZA5933_sample$d25_num
ZA5933_sample$d25_chr
```

## Advantages of dataset

The use of `dataset` helps to retain dataset-level metadata, which is critically important when we will combine datasets of different Eurobarometer survey waves, or make other interventions in the various stages of the survey lifecycle.

```{r dataset-metadata}
library(dataset)
ZA5933_sample
```
```{r}
attributes(ZA5933_sample)
```

